<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hypervault</title>

<script src="cryptojs-aes.min.js"></script>
<script src="filesaver.js"></script>
<script src="base64-binary.js"></script>

<script>

var fileDataRaw = "";

function readFileData(fileObj, callback) {
  var reader = new FileReader();

  reader.onload = (function(theFile) {
    return function(e) {
      callback(theFile.name, e.target.result);
    };
  })(fileObj);

  // Read in the image file as a data URL.
  // reader.readAsArrayBuffer
  reader.readAsDataURL(fileObj);
}

function getFileData() {
  var fileList = document.getElementById("uploadInput").files;
  var file1 = fileList[0];
  readFileData(file1, function (fileName, fileData) {
      fileDataRaw = fileData;
      console.log('File name:' + fileName);
      console.log(fileData);
  });
}



function hex2a(hex) {
  var str = '';
  for (var i = 0; i < hex.length; i += 2)
      str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
  return str;
}

function encryptFileData(fileData, passcode) {
  var encrypted = CryptoJS.AES.encrypt(fileData, passcode);
  return encrypted;
}

function decryptFileData(cipherData, passcode) {
  var decrypted = CryptoJS.AES.decrypt(cipherData, passcode);
  return hex2a(decrypted.toString())
}

var data = 'AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAA\nAAAAAABz/wAA4f8AAAAAAAAADf8A/64AAACM/wAA/64A/ysAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\nAAAAAAAAAAAAAAAAciIiIiIiIickQiIiIiIkQiQREiIiIRFCIhACIiIgASIiEGYiImYBIiIiZSIi\nViIiIiIiMiMiIiIiIiIiIiIiIiIiIiIiIiIiIiIiMiMiIiIiImUiIlYiIiIQZiIiZgEiIhACIiIg\nASIkERIiIiERQiRCIiIiIiRCciIiIiIiIid//gAAn/kAAIfhAADH4wAAw8MAAPPPAAD9vwAA//8A\nAP//AAD9vwAA888AAMPDAADH4wAAh+EAAJ/5AAB//gAA\n'

var blob = new Blob([Base64Binary.decode(data)], {
    type: "image/ico;",
});

function doDownload() {
  saveAs(blob, "favicon.ico");
}

</script>
</head>
<body>

  Upload example
  <form name="uploadForm">
    <input id="uploadInput" type="file" name="myFiles" onchange="getFileData();" multiple>
  </form>

  Download example
  <button onclick="doDownload()">Download image</button>

</body>
</html>
